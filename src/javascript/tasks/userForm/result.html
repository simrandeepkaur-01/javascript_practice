<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results</title>
    <link rel="stylesheet" href="../../../../dist/output.css">
</head>

<body class="flex justify-center items-center  flex-col bg-gray-100">
    <!-- navigation bar -->
    <nav class="w-screen h-20 flex items-center  bg-gray-800">
        <div class="w-1/2 ">
            <input id="js_search" type="search"
                class=" w-[400px] px-3 py-1.5 rounded-full ml-28 placeholder:text-gray-800"
                placeholder="Search Your User Name...">
        </div>
        <div class="flex space-x-4 flex-1 justify-end mr-6">
            <!-- add user button -->
            <div class="flex items-center">
                <button type="button" id="js_addNewUser"
                    class="bg-white relative text-gray-800 px-16 py-1.5 rounded-lg  text-md font-medium mr-12">Add New
                    User
                    <svg class="w-6 h-6 absolute top-1/2 -translate-y-1/2 left-9 text-gray-800"
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M0 0h24v24H0z" fill="none"></path>
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path>
                    </svg></button>
            </div>

            <!-- current user info -->
            <div class=" flex flex-col justify-center items-center">
                <img class="w-8 h-8 rounded-full"
                    src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTaQBkObFHtWztejWTFJJFCl7C0WajxHPAlTg&usqp=CAU"
                    alt="user Image">
                <p id="js_userName" class="text-white">username <span id="js_userRole">(role)</span></p>
            </div>

        </div>
    </nav>

    <table id="js_table" class="text-center w-10/12 rounded-lg shadow-lg shadow-gray-400 mt-16">
        <thead class="w-full h-16  bg-gray-800 rounded-full text-white">
            <tr>
                <th class="rounded-tl-lg">Image</th>
                <th>User Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Edit</th>
                <th class="rounded-tr-lg">Delete</th>
            </tr>
        </thead>
        <tbody id="js_tbody" class="w-full ">
        </tbody>
    </table>

    <script>
        const searchProducts = {
            input: document.querySelector('#js_searchInput'),
            listContainer: document.querySelector('#js_searchProduct'),

            debounce: function (func, delay) {
                let timer;
                return function (...args) {
                    clearTimeout(timer);
                    timer = setTimeout(() => func.apply(this, args), delay);
                }
            },

            search: function () {
                this.input.addEventListener('input', this.debounce(() => this.render(), 300));
                //hide list on click on screen
                document.addEventListener('click', (e) => {
                    if (!this.listContainer.contains(e.target)) {
                        this.listContainer.innerHTML = '';
                        this.input.value = '';
                    }
                })
            },

            render: function () {
                const products = JSON.parse(localStorage.getItem('products'));
                let searchedProduct = '';


                products.forEach(product => {
                    const productTitle = product.title.trim().toLowerCase();
                    const productCategory = product.category.trim().toLowerCase();

                    const searchedValue = this.input.value.trim().toLowerCase();


                    if (productCategory.includes(searchedValue) || productTitle.includes(searchedValue)) {
                        searchedProduct += `<li class='py-2 px-2.5 cursor-pointer flex items-center hover:bg-[#f2f5fa] dark:bg-gray-300 dark:hover:bg-slate-200 dark:border-b dark:border-gray-200 font-medium'>
                            <img src='${product.image}' class="mr-2 h-11 w-9">
                            <a href="#">${productTitle}</a></li>`;
                    }
                })
                this.listContainer.innerHTML = searchedProduct;

                this.listContainer.addEventListener('click', (e) => {
                    if (e.target.tagName === 'A') {
                        this.input.value = e.target.textContent;
                        // this.listContainer.innerHTML = '';
                    }
                })
            }

        }
        searchProducts.search()


        const user = {
            getUserFromLocalStorage: JSON.parse(localStorage.getItem('formData')) || [],

            render: function () {
                const tbody = document.getElementById('js_tbody');
                tbody.innerHTML = '';
                tbody.className = 'divide-y divide-y-red-800 ';

                const searchTerm = document.getElementById('js_search').value.toLowerCase().trim();

                this.getUserFromLocalStorage.forEach(element => {
                    const userName = element.firstName.trim().toLowerCase();
                    if (userName.includes(searchTerm)) {

                        let tr = document.createElement('tr');

                        let tdImage = document.createElement('td');
                        tdImage.className = 'flex justify-center p-1';
                        let imgElement = document.createElement('img');
                        imgElement.src = element.file;
                        imgElement.alt = 'User Image';
                        imgElement.classList = 'w-16 rounded-full ';
                        tdImage.appendChild(imgElement);

                        let tdName = this.createTableCell('td', `${element.firstName}`);
                        let tdEmail = this.createTableCell('td', `${element.email}`);
                        let tdRole = this.createTableCell('td', `${element.role}`);

                        let tdEdit = document.createElement('td');
                        let editBtn = this.createTableCell('button', 'Edit');
                        editBtn.className = 'rounded-lg px-7 py-1 bg-blue-600 text-white'
                        tdEdit.appendChild(editBtn);

                        let tdDelete = document.createElement('td');

                        let deleteBtn = this.createTableCell('button', 'Delete');
                        deleteBtn.className = 'rounded-lg px-4 py-1 bg-red-500 text-white';
                        tdDelete.appendChild(deleteBtn);

                        // delete data
                        deleteBtn.addEventListener('click', (e) => {
                            let confirmDelete = window.confirm('Do You Want to Delete Your Data?');

                            if (confirmDelete) {
                                let id = element.id;
                                this.getUserFromLocalStorage = this.getUserFromLocalStorage.filter((element) => {
                                    return element.id !== id;
                                });
                                localStorage.setItem('formData', JSON.stringify(this.getUserFromLocalStorage));
                                window.location.href = "./result.html";
                            }
                        })

                        // view data
                        editBtn.addEventListener('click', () => {
                            let id = element.id;
                            window.location.href = `./index.html?id=${id}`;
                        });

                        tbody.appendChild(tr);
                        tr.append(tdImage, tdName, tdEmail, tdRole, tdEdit, tdDelete);
                        tr.className = 'bg-white ';
                    }
                });
            },

            createTableCell: function (elem, textContent) {
                let element = document.createElement(elem);
                element.textContent = textContent;
                return element;
            },
            debounce(func, delay) {
                let timer;
                return function (...args) {
                    clearTimeout(timer);
                    timer = setTimeout(() => func.apply(this, args), delay);
                };
            },

            search() {
                const searchInput = document.getElementById('js_search');
                searchInput.addEventListener('input', this.debounce(() => this.render(), 500));
            },

            addNew() {
                const addUserBtn = document.getElementById('js_addNewUser');
                addUserBtn.addEventListener('click', () => window.location.href = "./index.html");
            }
        }

        user.render();
        user.search();
        user.addNew();
    </script>
</body>

</html>