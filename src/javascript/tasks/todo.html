<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="to-do list,add tasks,task management">
    <meta name="description" content="To-do list for task management and organization.">
    <title>To-do List</title>
    <link rel="stylesheet" href="../../../dist/output.css">
</head>

<body>
    <script>
        'use strict';

        function createNewElement(params) {
            let elem = document.createElement(params.element);
            elem.id = params.id;
            elem.className = params.className;
            return elem;
        }

        let main = document.createElement('main');
        document.body.appendChild(main);
        document.body.className = 'bg-[#e9effa]';

        let form = createNewElement({
            element: 'form',
            id: 'js_toDoAddTask',
            className: 'w-1/2 float-left pl-[240px] mt-0'
        });
        form.action = '#';
        main.appendChild(form);

        function createInput(params) {
            let elem = document.createElement(params.element);
            elem.type = params.type;
            elem.id = params.id;
            elem.className = params.className;
            elem.placeholder = params.placeholder;
            elem.autocomplete = params.autocomplete;
            return elem;
        }
        let toDoInput = createInput({
            element: 'input',
            type: 'text',
            id: 'js_toDoInput',
            className: 'w-[400px] rounded-l-full px-3 p-2 ring-1 ring-gray-400 dark:bg-gray-300 dark:placeholder:text-gray-700',
            placeholder: 'Enter your task Name',
            autocomplete: 'off'
        });

        function createButton(params) {
            let elem = document.createElement(params.element);
            elem.id = params.id;
            elem.className = params.className;
            elem.textContent = params.textContent;
            elem.type = params.type;
            elem.value = params.value;
            return elem;
        }

        let toDoInputSubmit = createButton({
            element: 'button',
            id: 'js_addBtnToDo',
            className: 'text-white px-6 p-[9px] rounded-r-full bg-gray-500 dark:bg-gray-900',
            textContent: 'Add',
            type: 'submit',
            value: 'Add your Task Name'
        });
        form.append(toDoInput, toDoInputSubmit);

        // search task and filter container
        let searchAndFilterContainer = createNewElement({
            element: 'div',
            id: 'js_search-filterDiv',
            className: 'flex justify-center space-x-12 w-1/2 mt-20'
        });
        main.appendChild(searchAndFilterContainer);

        let toDoSearch = createInput({
            element: 'input',
            type: 'search',
            id: 'js_toDoSearchTask',
            className: 'rounded-lg p-1.5 px-3 w-80 dark:bg-gray-300 bg-white dark:placeholder:text-gray-700',
            placeholder: 'Search For Task Here..',
            autocomplete: 'off'
        });
        toDoSearch.setAttribute('oninput', "searchTask()");

        let toDoSelect = createNewElement({
            element: 'select',
            id: 'js_toDoSelect',
            className: 'px-2 rounded-lg bg-white dark:bg-gray-300'
        });
        searchAndFilterContainer.append(toDoSearch, toDoSelect);

        // create select Option
        function createOption(element, value, textContent) {
            let elem = document.createElement(element);
            elem.element = element;
            elem.value = value;
            elem.textContent = textContent;
            return elem;
        }
        let toDoSelectAll = createOption('option', 'all', 'All');
        let toDoSelectComplete = createOption('option', 'complete', 'Complete');
        let toDoSelectInProgress = createOption('option', 'in-progress', 'In Progress');

        toDoSelect.append(toDoSelectAll, toDoSelectComplete, toDoSelectInProgress);

        // table

        let toDoTable = createNewElement({
            element: 'table',
            id: 'js_table',
            className: 'flex justify-between mx-auto w-[520px] max-h-96 bg-white dark:bg-gray-200 overflow-y-auto rounded-lg mt-14'
        });

        toDoTable.style = 'box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)';
        main.appendChild(toDoTable);

        let toDoTableTbody = document.createElement('tbody');
        toDoTableTbody.className = 'w-full divide-y divide-gray-200';
        toDoTable.appendChild(toDoTableTbody);

        // toDo functionality
        let toDoInputGet = document.getElementById('js_toDoInput');
        let toDoAddBtn = document.getElementById('js_addBtnToDo');
        let toDoArr = [];

        window.addEventListener('load', function (e) {
            e.preventDefault();
            const getData = localStorage.getItem('data');
            if (getData) {
                toDoArr = JSON.parse(getData);
                toDoArr.forEach((task) => {
                    renderToDo(task)
                })
            }
        })

        //Add a new task on click on Add Button.
        toDoAddBtn.addEventListener('click', function (e) {
            e.preventDefault();

            if (toDoInput.value.trim() === '') {
                alert('Please Enter Your TaskName');
                return;
            }

            // Create a to-do object
            let toDoObj = {}
            toDoObj.dateId = Date.now();
            toDoObj.taskName = toDoInputGet.value.trim();
            toDoObj.complete = false;

            // Push new task to array
            toDoArr.push(toDoObj);
            saveData();
            renderToDo(toDoObj);

            toDoInputGet.value = '';
        });

        let currentFilter = "all";

        // Search and Filter Tasks
        function searchAndFilterTasks() {
            const searchedInput = document.getElementById('js_toDoSearchTask').value.toLowerCase().trim();
            toDoTableTbody.innerHTML = '';

            const filteredTasks = toDoArr.filter(task => {
                const matchesSearch = task.taskName.toLowerCase().startsWith(searchedInput);

                if (currentFilter === "all" || (currentFilter === "complete" && task.complete) || (currentFilter === "in-progress" && !task.complete)) {
                    return matchesSearch;
                }
            });

            filteredTasks.forEach(task => {
                renderToDo(task);
            });
        }

        // Search Task Name
        function searchTask() {
            searchAndFilterTasks();
        }

        // Filter tasks based on the selected option
        document.querySelector('#js_toDoSelect').addEventListener('change', function (e) {
            e.preventDefault();
            currentFilter = this.value;
            searchAndFilterTasks();
        });

        searchAndFilterTasks();

        function renderToDo(taskObj) {
            let toDoTableRow = createNewElement({
                element: 'tr',
                id: 'js_toDoTableRow',
                className: 'flex justify-between p-2.5  hover:bg-[#f2f5fa] dark:bg-gray-300 dark:hover:bg-slate-200'
            });
            let firstRow = toDoTableTbody.firstElementChild;

            firstRow ? toDoTableTbody.insertBefore(toDoTableRow, firstRow) : toDoTableTbody.appendChild(toDoTableRow);

            let toDoTableData = createNewElement({
                element: 'td',
                id: 'js_toDoTableData',
                className: 'flex justify-between w-full'
            });
            toDoTableRow.appendChild(toDoTableData);

            let toDoTableDataSpan = createNewElement({
                element: 'span',
                id: 'js_taskName',
                className: 'w-64 truncate'
            });
            toDoTableDataSpan.textContent = taskObj.taskName;

            let toDoBtnDiv = document.createElement('div');

            let toDoCompleteBtn = createButton({
                element: 'button',
                id: 'js_completeBtn',
                className: 'px-3 py-0.5 rounded-lg !mr-3 bg-gray-500 text-white',
                textContent: 'Complete',
                type: 'button',
                value: 'complete/incomplete'
            });
            taskObj.complete ? toDoCompleteBtn.className = 'px-3 py-0.5 rounded-lg !mr-3 bg-green-700 text-white' : toDoCompleteBtn.className = 'px-3 py-0.5 rounded-lg !mr-3 bg-gray-500 text-white';

            let toDoDeleteBtn = createButton({
                element: 'button',
                id: 'js_deleteBtn',
                className: 'px-3 py-0.5 rounded-lg bg-red-500 text-white',
                textContent: 'Delete',
                type: 'button',
                value: 'delete'
            });
            toDoDeleteBtn.setAttribute('data-key', taskObj.dateId);

            toDoBtnDiv.append(toDoCompleteBtn, toDoDeleteBtn);
            toDoTableData.append(toDoTableDataSpan, toDoBtnDiv);

            //Removing task from ToDo list
            toDoDeleteBtn.addEventListener('click', function (e) {
                e.preventDefault();
                const index = toDoArr.findIndex((task) => task.dateId === taskObj.dateId)
                if (index != -1) {
                    
                    toDoArr.splice(index, 1)
                    toDoTableRow.remove()
                    saveData();
                }
            })

            toDoCompleteBtn.textContent = taskObj.complete ? 'Completed' : 'Incomplete';

            if (taskObj.complete) {
                toDoTableDataSpan.classList.add('line-through');
            } else {
                toDoTableDataSpan.classList.remove('line-through');
            }

            //Marking the task as Complete/Incomplete
            toDoCompleteBtn.addEventListener('click', function (e) {
                e.preventDefault();
                taskObj.complete = !taskObj.complete;
                saveData();

                // Update the button text
                toDoCompleteBtn.textContent = taskObj.complete ? 'Completed' : 'Incomplete';
                taskObj.complete ? toDoCompleteBtn.className = 'px-3 py-0.5 rounded-lg !mr-3 bg-green-700 text-white' : toDoCompleteBtn.className = 'px-3 py-0.5 rounded-lg !mr-3 bg-gray-500 text-white';

                toDoTableDataSpan.classList.toggle('line-through');
            })
        }

        function saveData() {
            localStorage.setItem('data', JSON.stringify(toDoArr));
        }

    </script>

</body>

</html>